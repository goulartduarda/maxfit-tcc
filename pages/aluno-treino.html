<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MaxFit â€” Meus Treinos</title>

  <!-- Bootstrap e Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --mf-primary: #FF6A00;
      --mf-bg: #0f0f10;
      --mf-card: #17181a;
      --mf-border: #2a2b2e;
    }

    body {
      background: linear-gradient(180deg, var(--mf-bg), #121317 60%);
      color: #e9ecef;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
    }

    .mf-navbar {
      background: #0e0f10d6;
      border-bottom: 1px solid var(--mf-border);
      backdrop-filter: blur(6px);
    }

    .mf-card {
      background: var(--mf-card);
      border: 1px solid var(--mf-border);
      border-radius: 1.25rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .brand-badge {
      display: inline-flex;
      gap: .5rem;
      align-items: center;
      font-weight: 700;
    }

    .brand-badge i {
      color: var(--mf-primary);
    }

    .list-exercicio {
      background: #141518;
      border: 1px solid var(--mf-border);
      border-radius: .5rem;
      padding: .75rem 1rem;
      margin-bottom: .5rem;
    }

    .list-exercicio strong {
      color: var(--mf-primary);
    }

    .data-criacao {
      font-size: 0.85rem;
      color: #aaa;
    }
  </style>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-dark mf-navbar sticky-top">
    <div class="container py-2 d-flex justify-content-between align-items-center">
      <span class="brand-badge"><i class="fa-solid fa-dumbbell"></i> MaxFit â€” <span class="text-white-50">Aluno</span></span>
      <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-outline-light" href="inicio.html"><i class="fa-solid fa-house"></i></a>
        <a class="btn btn-sm btn-light" href="aluno-treino.html">Meus Treinos</a>
      </div>
    </div>
  </nav>

  <!-- CONTEÃšDO -->
  <main class="container py-5">
    <div id="areaTreinos"></div>
  </main>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API = "http://localhost:3000";

    document.addEventListener("DOMContentLoaded", async () => {
      const areaTreinos = document.getElementById("areaTreinos");

      // ðŸ”¹ Recupera o aluno logado
      const alunoId = localStorage.getItem("current_user_id");
      const tipo = localStorage.getItem("current_user_tipo");

      if (!alunoId || tipo !== "aluno") {
        alert("Acesso restrito. FaÃ§a login novamente como aluno.");
        window.location.href = "/pages/06-entrar.html";
        return;
      }

      // ðŸ”¹ Carregar treinos do aluno
      async function carregarTreinos() {
        try {
          const resp = await fetch(`${API}/api/treinos/${alunoId}`);
          const treinos = await resp.json();

          areaTreinos.innerHTML = "";

          if (!Array.isArray(treinos) || treinos.length === 0) {
            areaTreinos.innerHTML = `
              <div class="mf-card text-center text-muted">
                <p>Nenhum treino disponÃ­vel no momento.</p>
              </div>
            `;
            return;
          }

          treinos.forEach(t => {
            const card = document.createElement("div");
            card.className = "mf-card";

            const dataCriacao = t.criado_em 
              ? new Date(t.criado_em).toLocaleDateString('pt-BR', { timeZone: 'UTC' })
              : "Data nÃ£o informada";

            let exerciciosHTML = "";
            if (t.exercicios && t.exercicios.length > 0) {
              exerciciosHTML = t.exercicios.map(ex => `
                <div class="list-exercicio">
                  <strong>${ex.nome}</strong><br>
                  SÃ©ries: ${ex.series || "-"} â€” Reps: ${ex.repeticoes || "-"} â€” Descanso: ${ex.descanso || "-"}
                </div>
              `).join("");
            } else {
              exerciciosHTML = `<p class="text-secondary">Nenhum exercÃ­cio cadastrado.</p>`;
            }

            card.innerHTML = `
              <h5 class="mb-1">${t.titulo}</h5>
              <p class="data-criacao mb-2">Criado em ${dataCriacao}</p>
              <p class="mb-1"><strong>Objetivo:</strong> ${t.objetivo || "NÃ£o informado"}</p>
              <p class="mb-1"><strong>NÃ­vel:</strong> ${t.nivel || "NÃ£o definido"}</p>
              <p class="mb-3"><strong>Validade:</strong> ${t.validade ? new Date(t.validade).toLocaleDateString('pt-BR', { timeZone: 'UTC' }) : "Sem data"}</p>
              ${exerciciosHTML}
            `;

            areaTreinos.appendChild(card);
          });
        } catch (err) {
          console.error("Erro ao carregar treinos:", err);
          areaTreinos.innerHTML = `
            <div class="mf-card text-center text-danger">
              <p>Erro ao carregar treinos. Tente novamente mais tarde.</p>
            </div>
          `;
        }
      }

      carregarTreinos();
    });
  </script>
</body>
</html>
